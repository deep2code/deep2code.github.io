<!DOCTYPE html>
<html lang="zh" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.101.0" />
    <meta name="description" content="">
<meta name="author" content="deep2code">

    <link rel="icon" href="/images/favicon.jpeg" type="image/jpeg">

    <title>golang :: 技术博客</title>

    
    <link href="/css/nucleus.css?1677750506" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1677750506" rel="stylesheet">
    <link href="/css/hybrid.css?1677750506" rel="stylesheet">
    <link href="/css/featherlight.min.css?1677750506" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1677750506" rel="stylesheet">
    <link href="/css/auto-complete.css?1677750506" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1677750506" rel="stylesheet">
    <link href="/css/theme.css?1677750506" rel="stylesheet">
    <link href="/css/tabs.css?1677750506" rel="stylesheet">
    <link href="/css/hugo-theme.css?1677750506" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1677750506" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1677750506"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/golang/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/"><img id="logo" src= "/images/logo.jpeg" ></img></a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1677750506"></script>
<script type="text/javascript" src="/js/auto-complete.js?1677750506"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1677750506"></script>

    
  </div>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/ai/" title="Ais" class="dd-item
        
        
        
        ">
      <a href="/ai/">
          Ais
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/ai/__index/" title="ai" class="dd-item ">
        <a href="/ai/__index/">
        ai
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/elastic/" title="elastic" class="dd-item
        
        
        
        ">
      <a href="/elastic/">
          elastic
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/flutter/" title="flutter" class="dd-item
        
        
        
        ">
      <a href="/flutter/">
          flutter
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/git/" title="git" class="dd-item
        
        
        
        ">
      <a href="/git/">
          git
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/golang/" title="golang" class="dd-item
        
        active
        
        ">
      <a href="/golang/">
          golang
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/golang/context/" title="context" class="dd-item ">
        <a href="/golang/context/">
        context
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/echo/" title="echo" class="dd-item ">
        <a href="/golang/echo/">
        echo
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/regexp/" title="exgexp包" class="dd-item ">
        <a href="/golang/regexp/">
        exgexp包
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/freetype/" title="freetype" class="dd-item ">
        <a href="/golang/freetype/">
        freetype
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/gin/" title="gin" class="dd-item ">
        <a href="/golang/gin/">
        gin
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/go-git/" title="go-git" class="dd-item ">
        <a href="/golang/go-git/">
        go-git
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/io/" title="io包" class="dd-item ">
        <a href="/golang/io/">
        io包
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/iris/" title="iris" class="dd-item ">
        <a href="/golang/iris/">
        iris
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/log/" title="log" class="dd-item ">
        <a href="/golang/log/">
        log
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/shell/" title="shell" class="dd-item ">
        <a href="/golang/shell/">
        shell
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/sort/" title="sort包" class="dd-item ">
        <a href="/golang/sort/">
        sort包
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/stringer/" title="stringer" class="dd-item ">
        <a href="/golang/stringer/">
        stringer
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/package/" title="常用包" class="dd-item ">
        <a href="/golang/package/">
        常用包
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/code/" title="代码片断" class="dd-item ">
        <a href="/golang/code/">
        代码片断
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/generic/" title="泛型" class="dd-item ">
        <a href="/golang/generic/">
        泛型
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/golang/groupby/" title="泛型切片分组" class="dd-item ">
        <a href="/golang/groupby/">
        泛型切片分组
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/grpc/" title="grpc" class="dd-item
        
        
        
        ">
      <a href="/grpc/">
          grpc
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/grpc/golang/" title="golang示例" class="dd-item ">
        <a href="/grpc/golang/">
        golang示例
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/mac/" title="mac" class="dd-item
        
        
        
        ">
      <a href="/mac/">
          mac
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/memcached/" title="memcached" class="dd-item
        
        
        
        ">
      <a href="/memcached/">
          memcached
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/mysql/" title="mysql" class="dd-item
        
        
        
        ">
      <a href="/mysql/">
          mysql
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/nginx/" title="nginx" class="dd-item
        
        
        
        ">
      <a href="/nginx/">
          nginx
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/nginx/http/" title="HTTP模块" class="dd-item
        
        
        
        ">
      <a href="/nginx/http/">
          HTTP模块
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/nginx/rtmp/" title="rtmp" class="dd-item
        
        
        
        ">
      <a href="/nginx/rtmp/">
          rtmp
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/nginx/use/" title="常用技巧" class="dd-item
        
        
        
        ">
      <a href="/nginx/use/">
          常用技巧
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/nginx/install/" title="源码安装剖析" class="dd-item
        
        
        
        ">
      <a href="/nginx/install/">
          源码安装剖析
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/python/" title="python" class="dd-item
        
        
        
        ">
      <a href="/python/">
          python
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/redis/" title="redis" class="dd-item
        
        
        
        ">
      <a href="/redis/">
          redis
          
      </a>
      
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/other/" title="更多" class="dd-item
        
        
        
        ">
      <a href="/other/">
          更多
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/other/brew/" title="brew-酿制" class="dd-item
        
        
        
        ">
      <a href="/other/brew/">
          brew-酿制
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/docker/" title="docker" class="dd-item
        
        
        
        ">
      <a href="/other/docker/">
          docker
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/firefox/" title="firefox" class="dd-item
        
        
        
        ">
      <a href="/other/firefox/">
          firefox
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/github/" title="github" class="dd-item
        
        
        
        ">
      <a href="/other/github/">
          github
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/gitlab/" title="gitlab" class="dd-item
        
        
        
        ">
      <a href="/other/gitlab/">
          gitlab
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/harbor/" title="harbor" class="dd-item
        
        
        
        ">
      <a href="/other/harbor/">
          harbor
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/hugo/" title="hugo" class="dd-item
        
        
        
        ">
      <a href="/other/hugo/">
          hugo
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/machinelearn/" title="machinelearn" class="dd-item
        
        
        
        ">
      <a href="/other/machinelearn/">
          machinelearn
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/makefile/" title="makefile" class="dd-item
        
        
        
        ">
      <a href="/other/makefile/">
          makefile
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/markdown/" title="markdown" class="dd-item
        
        
        
        ">
      <a href="/other/markdown/">
          markdown
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/mermaid/" title="mermaid-美人鱼" class="dd-item
        
        
        
        ">
      <a href="/other/mermaid/">
          mermaid-美人鱼
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/rpc/" title="rpc" class="dd-item
        
        
        
        ">
      <a href="/other/rpc/">
          rpc
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/rust/" title="Rust" class="dd-item
        
        
        
        ">
      <a href="/other/rust/">
          Rust
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/shell/" title="shell" class="dd-item
        
        
        
        ">
      <a href="/other/shell/">
          shell
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/svn/" title="svn" class="dd-item
        
        
        
        ">
      <a href="/other/svn/">
          svn
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/tesseract/" title="tesseract" class="dd-item
        
        
        
        ">
      <a href="/other/tesseract/">
          tesseract
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/unity/" title="unity" class="dd-item
        
        
        
        ">
      <a href="/other/unity/">
          unity
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/other/unity/et/" title="ET框架" class="dd-item
        
        
        
        ">
      <a href="/other/unity/et/">
          ET框架
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/vim/" title="vim" class="dd-item
        
        
        
        ">
      <a href="/other/vim/">
          vim
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/wasm/" title="wasm" class="dd-item
        
        
        
        ">
      <a href="/other/wasm/">
          wasm
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/web/" title="web" class="dd-item
        
        
        
        ">
      <a href="/other/web/">
          web
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/windows/" title="windows" class="dd-item
        
        
        
        ">
      <a href="/other/windows/">
          windows
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/wireshark/" title="wireshark" class="dd-item
        
        
        
        ">
      <a href="/other/wireshark/">
          wireshark
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/aliyun/" title="阿里云" class="dd-item
        
        
        
        ">
      <a href="/other/aliyun/">
          阿里云
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/geocode/" title="地理编码" class="dd-item
        
        
        
        ">
      <a href="/other/geocode/">
          地理编码
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/search/" title="搜索技巧" class="dd-item
        
        
        
        ">
      <a href="/other/search/">
          搜索技巧
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/tencent/" title="腾讯" class="dd-item
        
        
        
        ">
      <a href="/other/tencent/">
          腾讯
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/other/opensource/" title="优秀开源软件" class="dd-item
        
        
        
        ">
      <a href="/other/opensource/">
          优秀开源软件
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>主页</a> > golang
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#官网httpsgodev"><a href="https://go.dev/">官网</a></a></li>
        <li><a href="#环境变量">环境变量</a></li>
        <li><a href="#go-mod命令指南httpsgodevdocmodulesgomod-ref"><a href="https://go.dev/doc/modules/gomod-ref">go mod命令指南</a></a></li>
        <li><a href="#工作区-多模块httpsgodevrefmodworkspaces"><a href="https://go.dev/ref/mod#workspaces">工作区-多模块</a></a></li>
        <li><a href="#相关工具go-tools">相关工具go tools</a></li>
        <li><a href="#go-generate命令">go generate命令</a></li>
        <li><a href="#核心语法">核心语法</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              golang
            </h1>
          

        



	<h3 id="官网httpsgodev"><a href="https://go.dev/">官网</a></h3>
<hr>
<ul>
<li><a href="https://go.extension.sh/">Go Search Extension</a>浏览器扩展, 地址栏输入go+空格启用
<img src="golang_gosearch.webp" alt="golang_gosearch"></li>
<li>golang.org国内经常访问不了</li>
<li>通过go bulid -tags 实现编译控制</li>
<li>内置数据类型定义在runtime包,如下图所示
<img src="golang_runtime.webp" alt="源码"></li>
<li>吐槽一下
<ul>
<li>破坏注释不影响代码的传统,这类//go:注释,有特别含义,会影响代码作用,使用者非常容易误解</li>
<li>强制mod方式管理第三方模块
<ul>
<li>用代码库+版本解决依赖</li>
<li>带来重大著名库大量重复存在,GOPATH成垃圾桶
<img src="golang_gopath_x.webp" alt="go path x"></li>
<li>带来更多名词,增加心智负担,精力分散在语言之外过多</li>
<li>严重偏向开源开发模式,对闭源开发不友好</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="环境变量">环境变量</h3>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 安装到默认目录</span>
</span></span><span style="display:flex;"><span>rm -rf /usr/local/go <span style="color:#f92672">&amp;&amp;</span> tar -C /usr/local -xzf go1.19.linux-amd64.tar.gz
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 导出环境变量</span>
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span>$PATH:/usr/local/go/bin
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查看安装成功否</span>
</span></span><span style="display:flex;"><span>go version
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#列出环境变量</span>
</span></span><span style="display:flex;"><span>go env
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GOPATH环境变量,如果没有手动设置,默认为$HOME/go</span>
</span></span><span style="display:flex;"><span>GOPATH<span style="color:#f92672">=</span>$HOME/go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#模块缓存是 go 命令存储下载模块文件的目录,默认是$GOPATH/pkg/mod.</span>
</span></span><span style="display:flex;"><span>GOMODCACHE
</span></span><span style="display:flex;"><span><span style="color:#75715e">#清除mod cache,pkg目录里面全没了</span>
</span></span><span style="display:flex;"><span>go clean --modcache
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Build Cache意思就是会把编译过程的中间结果cache下来，从而实现增量编译。</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#Test cache，在内容没有变化的情况下，对于同样的参数的测试，会直接使用cache的测试结果</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#cache默认的存储路径是操作系统所确定的用户缓存目录，但是可以通过GOCACHE环境变量修改</span>
</span></span><span style="display:flex;"><span>GOCACHE
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#清除build cache</span>
</span></span><span style="display:flex;"><span>go clean -cache
</span></span><span style="display:flex;"><span><span style="color:#75715e">#清除test cache</span>
</span></span><span style="display:flex;"><span>go clean -testcache
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GOPROXY(公共)修改为国内代理</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#全球代理https://proxy.golang.com.cn(https://goproxy.io/)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#阿里云 https://mirrors.aliyun.com/goproxy/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#七牛云 https://goproxy.cn</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#direct表示直接从包路径下载</span>
</span></span><span style="display:flex;"><span>go env -w GOPROXY<span style="color:#f92672">=</span>https://goproxy.cn,direct
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GOPRIVATE设置私有库</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#还可以设置不走 proxy 的私有仓库或组，多个用逗号相隔（可选）</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#允许通配符</span>
</span></span><span style="display:flex;"><span>go env -w GOPRIVATE<span style="color:#f92672">=</span>git.mycompany.com,github.com/my/private,*.example.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GOVCS变量</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#可以使用git下载带有 github.com 路径的模块；无法使用任何版本控制命令下载 evil.com上的路径</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#使用 git 或 hg 下载所有其他路径（* 匹配所有内容）的模块。</span>
</span></span><span style="display:flex;"><span>GOVCS<span style="color:#f92672">=</span>github.com:git,evil.com:off,*:git|hg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GOSUMDB变量</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#默认的GOSUMDB=sum.golang.org验证包的有效性,经常访问不了</span>
</span></span><span style="display:flex;"><span>go env -w GOSUMDB<span style="color:#f92672">=</span>off
</span></span><span style="display:flex;"><span><span style="color:#75715e">#使用国内代理</span>
</span></span><span style="display:flex;"><span>go env -w GOSUMDB<span style="color:#f92672">=</span>https://goproxy.cn/sumdb/sum.golang.org,sum.golang.org
</span></span></code></pre></div><ul>
<li>
<p>GOPROXY说明</p>
<ul>
<li>You can set the variable to URLs for other module proxy servers, separating URLs with either a comma or a pipe.</li>
<li>When you use a comma, Go tools will try the next URL in the list only if the current URL returns an HTTP 404 or 410.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>GOPROXY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://proxy.example.com,https://proxy2.example.com&#34;</span>
</span></span></code></pre></div><ul>
<li>When you use a pipe, Go tools will try the next URL in the list regardless of the HTTP error code.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>GOPROXY<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://proxy.example.com|https://proxy2.example.com&#34;</span>
</span></span></code></pre></div></li>
<li>
<p>GOPRIVATE说明</p>
<ul>
<li>The GOPRIVATE or GONOPROXY environment variables may be set to lists of glob patterns matching module prefixes that are private and should not be requested from any proxy.</li>
</ul>
</li>
<li>
<p>GOVCS说明</p>
<ul>
<li>版本控制工具中的错误可能被恶意服务器利用来运行恶意代码</li>
<li>如果未设置环境变量GOVCS,或者不匹配,GOVCS的默认处理:允许 git 和 hg 用于公共模块,并且允许所有工具用于私有模块。</li>
</ul>
</li>
</ul>
<h3 id="go-mod命令指南httpsgodevdocmodulesgomod-ref"><a href="https://go.dev/doc/modules/gomod-ref">go mod命令指南</a></h3>
<hr>
<p><img src="golang_package.webp" alt="golang_package"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#最后结果都是写入go.mod文件</span>
</span></span><span style="display:flex;"><span>go mod init path
</span></span><span style="display:flex;"><span>go mod edit --replace modulepath<span style="color:#f92672">=</span>otherpath
</span></span><span style="display:flex;"><span>go mod edit --exclude modulepath
</span></span><span style="display:flex;"><span><span style="color:#75715e">#tidy整理依赖,增加没有添加或移除未引用等</span>
</span></span><span style="display:flex;"><span>go mod tidy
</span></span><span style="display:flex;"><span><span style="color:#75715e">#整检依赖是否正解</span>
</span></span><span style="display:flex;"><span>go mod verify
</span></span></code></pre></div><ul>
<li><strong>采用mod方式管理依赖,则没有gopath/src,改到gopath/mod</strong></li>
<li><strong>go.sum不需要手工维护,也不要手工改动</strong></li>
<li><strong>所有的子目录里的依赖都组织在根目录的go.mod文件</strong></li>
<li>replace指令场景
<ul>
<li>替换无法下载的包</li>
<li>替换本地自己的包</li>
<li>替换 fork 包</li>
</ul>
</li>
<li>exclude显式的排除某个包的某个版本,例如某个版本有严重bug,如果其他包引用这个版本,就会自动跳过这个版本</li>
<li><a href="https://zhuanlan.zhihu.com/p/126561786">文章</a>介绍较直白</li>
<li><a href="https://segmentfault.com/a/1190000039359906">文章</a>介绍<strong>retract</strong>指令
<img src="golang_mod.webp" alt="go mod"></li>
</ul>
<h3 id="工作区-多模块httpsgodevrefmodworkspaces"><a href="https://go.dev/ref/mod#workspaces">工作区-多模块</a></h3>
<hr>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#最后结果都是写入go.work文件</span>
</span></span><span style="display:flex;"><span>Usage:
</span></span><span style="display:flex;"><span> go work &lt;command&gt; <span style="color:#f92672">[</span>arguments<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>The commands are:
</span></span><span style="display:flex;"><span> edit        edit go.work from tools or scripts
</span></span><span style="display:flex;"><span> init        initialize workspace file
</span></span><span style="display:flex;"><span> sync        sync workspace build list to modules
</span></span><span style="display:flex;"><span> use         add modules to workspace file
</span></span></code></pre></div><ul>
<li>workspace目录</li>
</ul>
<p><img src="golang_workspace.webp" alt="go work"></p>
<ul>
<li>go.work内容</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#go work use ./hello</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#go work use ./example</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#./hello,./example是本地路径,不是example,hello的module名</span>
</span></span><span style="display:flex;"><span>go 1.18
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>use <span style="color:#f92672">(</span>
</span></span><span style="display:flex;"><span> ./example
</span></span><span style="display:flex;"><span> ./hello
</span></span><span style="display:flex;"><span><span style="color:#f92672">)</span>
</span></span></code></pre></div><ul>
<li>hello/main.go内容</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;golang.org/x/example/stringutil&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">stringutil</span>.<span style="color:#a6e22e">ToUpper</span>(<span style="color:#e6db74">&#34;Hello&#34;</span>))
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>hello/go.mod内容</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>module example.com/hello
</span></span><span style="display:flex;"><span>go 1.18
</span></span><span style="display:flex;"><span>require golang.org/x/example v0.0.0-20220304235025-ad95e7f791d8 // indirect
</span></span></code></pre></div><ul>
<li>
<ol>
<li>在workspace目录下运行go run example.com/hello</li>
</ol>
</li>
<li>
<ol start="2">
<li>不用改动go.mod,使得golang.org/x/example由本工作区的example替代</li>
</ol>
</li>
<li>
<ol start="3">
<li>可实现多模块同时开发</li>
</ol>
</li>
</ul>
<h3 id="相关工具go-tools">相关工具go tools</h3>
<hr>
<h4 id="getinstall下载包过程">get/install下载包过程</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// import &#34;example.org/pkg/foo&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// will result in the following requests:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// https://example.org/pkg/foo?go-get=1 (preferred)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// http://example.org/pkg/foo?go-get=1  (fallback, only with use of correctly set GOINSECURE)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// If that page contains the meta tag
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// &lt;meta name=&#34;go-import&#34; content=&#34;example.org git https://code.org/r/p/exproj&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// the go tool will verify that https://example.org/?go-get=1 contains the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// same meta tag and then git clone https://code.org/r/p/exproj into
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// GOPATH/src/example.org.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// go get/install当服务器支持多种协议优先使用https://, 然后git+ssh://.
</span></span></span></code></pre></div><p><img src="golang_go_get.webp" alt="go_get"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#包括godoc等工具</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#./godoc -http :6060</span>
</span></span><span style="display:flex;"><span>go install golang.org/x/tools/...@latest.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#浏览器本地文档，如果起启目录有go.mod会继续分析提供文档,但是增加启动时间</span>
</span></span><span style="display:flex;"><span>godoc -http :6060
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#安装pprof,如果不在mod目录下运行,就指明@latest最近版本</span>
</span></span><span style="display:flex;"><span>go install github.com/google/pprof@latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#下载最新版本</span>
</span></span><span style="display:flex;"><span>go get example.com/theirmodule@vlatest
</span></span><span style="display:flex;"><span><span style="color:#75715e">#下载指定版本</span>
</span></span><span style="display:flex;"><span>go get example.com/theirmodule@v1.3.4
</span></span><span style="display:flex;"><span>go get example.com/theirmodule@4cf76c2
</span></span><span style="display:flex;"><span>go get example.com/theirmodule@bugfixes
</span></span><span style="display:flex;"><span><span style="color:#75715e">#移除指定版本模块</span>
</span></span><span style="display:flex;"><span>go get example.com/theirmodule@none
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看所有依赖模块的最新版本</span>
</span></span><span style="display:flex;"><span>go list -m -u all
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看指定模块的最新版本</span>
</span></span><span style="display:flex;"><span>go list -m -u example.com/theirmodule
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#升级后会将新的依赖版本更新到go.mod</span>
</span></span><span style="display:flex;"><span>go get -u need-upgrade-package
</span></span><span style="display:flex;"><span><span style="color:#75715e">#升级所有依赖</span>
</span></span><span style="display:flex;"><span>go get -u 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go tool pprof
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>go tool trace
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取当前git hash</span>
</span></span><span style="display:flex;"><span>Cgithash<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>git rev-parse --short HEAD<span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取当前时间</span>
</span></span><span style="display:flex;"><span>Ctime<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date <span style="color:#e6db74">&#39;+%Y-%m-%d_%H:%M:%S&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 交叉编译</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 禁止cgo</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置编译目标平台</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 设置编译芯片体系</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#-s: 去掉符号表; -w:去掉调试信息，不能gdb调试了;</span>
</span></span><span style="display:flex;"><span>CGO_ENABLED<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> GOARCH<span style="color:#f92672">=</span>amd64 GOOS<span style="color:#f92672">=</span>linux go build -o <span style="color:#e6db74">${</span>target<span style="color:#e6db74">}</span> -ldflags <span style="color:#e6db74">&#34;-s -w -X main.GitHash=</span><span style="color:#e6db74">${</span>Cgithash<span style="color:#e6db74">}</span><span style="color:#e6db74"> -X main.CompileTime=</span><span style="color:#e6db74">${</span>Ctime<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> main.go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#获取程序更多信息(包括-ldflags参数设置)</span>
</span></span><span style="display:flex;"><span>go version -m 二进制可执行文件
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#新增inittrace指令, 用于init调试和启动时间的概要分析</span>
</span></span><span style="display:flex;"><span>GODEBUG<span style="color:#f92672">=</span>inittrace<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> go run main.go 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#简化代码</span>
</span></span><span style="display:flex;"><span>gofmt -s -w xxx.go
</span></span></code></pre></div><p><img src="golang_godoc.webp" alt="golang_godoc"></p>
<ul>
<li><a href="https://eddycjy.com/posts/go/tools/2018-09-15-go-tool-pprof/">文章</a>介绍pprof</li>
<li><a href="https://eddycjy.com/posts/go/tools/2019-07-12-go-tool-trace/">文章</a>介绍trace</li>
<li><a href="https://taoshu.in/go/create-protoc-plugin.html">创建protoc插件</a></li>
</ul>
<h5 id="golangci-linthttpsgithubcomgolangcigolangci-lint替代品lint-静态检查库httpsgithubcommgechevrevive"><a href="https://github.com/golangci/golangci-lint">golangci-lint</a>,替代品<a href="https://github.com/mgechev/revive">lint-静态检查库</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#快速安装,会自动下载依赖安装对应的go版本,如果系统安装有go,那么注意搜索PATH</span>
</span></span><span style="display:flex;"><span>brew install golangci-lint
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#手动下载,选择最新及相应的平台,最新版本在go1.18有部分lint不支持,需要适时更新</span>
</span></span><span style="display:flex;"><span>https://github.com/golangci/golangci-lint/releases
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#较大规模项目,或第一次运行应该增加超时选择</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#golangci-lint会采用缓存,如果环境变没有设置,则采用系统默认设置</span>
</span></span><span style="display:flex;"><span>golangci-lint run --timeout<span style="color:#f92672">=</span>1h
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#GolangCI-Lint looks for config files in the following paths from the current working directory:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.golangci.yml
</span></span><span style="display:flex;"><span>.golangci.yaml
</span></span><span style="display:flex;"><span>.golangci.toml
</span></span><span style="display:flex;"><span>.golangci.json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#这几个参数比较有用</span>
</span></span><span style="display:flex;"><span>  skip-dirs:
</span></span><span style="display:flex;"><span>    - src/external_libs
</span></span><span style="display:flex;"><span>    - autogenerated_by_my_lib
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Enables skipping of directories:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># - vendor$, third_party$, testdata$, examples$, Godeps$, builtin$</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Default: true</span>
</span></span><span style="display:flex;"><span>  skip-dirs-use-default: false
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Which files to skip: they will be analyzed, but issues from them won&#39;t be reported.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Default value is empty list,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># but there is no need to include all autogenerated files,</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># we confidently recognize autogenerated files.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># If it&#39;s not please let us know.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># &#34;/&#34; will be replaced by current OS file path separator to properly work on Windows.</span>
</span></span><span style="display:flex;"><span>  skip-files:
</span></span><span style="display:flex;"><span>    - <span style="color:#e6db74">&#34;.*\\.my\\.go</span>$<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    - lib/bad.go
</span></span></code></pre></div><h5 id="小米出品-soar-sql优化改写httpsgithubcomxiaomisoar"><a href="https://github.com/XiaoMi/soar">小米出品-Soar-sql优化改写</a></h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#手动下载,选择最新及相应的平台,老黄历版本啦!</span>
</span></span><span style="display:flex;"><span>https://github.com/XiaoMi/soar/releases
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#源码安装,报gopath/pkg/mod/github.com/!xiao!mi/soar@v0.8.1/ast/tidb.go:24:2: ambiguous import:</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#解决办法:跳过此种方式，估计没有指到最新版本,没心情找原因</span>
</span></span><span style="display:flex;"><span>go install github.com/XiaoMi/soar/cmd/soar@latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#最原始办法</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/XiaoMi/soar.git
</span></span><span style="display:flex;"><span>cd soar
</span></span><span style="display:flex;"><span>make
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#测试使用</span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#39;select * from film&#39;</span> | ./soar
</span></span></code></pre></div><h3 id="go-generate命令">go generate命令</h3>
<ul>
<li>
<p>当运行go generate时,它将扫描与当前包相关的源代码文件,找出所有包含&quot;//go:generate&quot;的特殊注释</p>
</li>
<li>
<p>提取并执行该特殊注释后面的命令,命令为可执行程序，形同shell下面执行</p>
<ul>
<li>该特殊注释必须在.go源码文件中。</li>
<li>每个源码文件可以包含多个generate特殊注释时。</li>
<li>显示运行go generate命令时，才会执行特殊注释后面的命令。</li>
<li>命令串行执行的，如果出错，就终止后面的执行。</li>
<li>特殊注释必须以&quot;//go:generate&quot;开头，双斜线后面没有空格。</li>
</ul>
</li>
<li>
<p>应用</p>
<ul>
<li>yacc：从 .y 文件生成 .go 文件。</li>
<li>protobufs：从 protocol buffer 定义文件（.proto）生成 .pb.go 文件。</li>
<li>Unicode：从 UnicodeData.txt 生成 Unicode 表</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>go generate <span style="color:#f92672">[</span>-run regexp<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-n<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-v<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-x<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>build flags<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>file.go... | packages<span style="color:#f92672">]</span>
</span></span></code></pre></div><ul>
<li>
<p>参数说明如下：</p>
<ul>
<li>-run 正则表达式匹配命令行，仅执行匹配的命令；</li>
<li>-v 输出被处理的包名和源文件名；</li>
<li>-n 显示不执行命令；</li>
<li>-x 显示并执行命令；</li>
<li>command 可以是在环境变量 PATH 中的任何命令。</li>
</ul>
</li>
</ul>
<h3 id="核心语法">核心语法</h3>
<hr>
<ul>
<li>
<p>逃逸分析</p>
<ul>
<li>
<p>目标:减轻堆内存分配开销，减少gc压力，提高运行性能</p>
</li>
<li>
<p>编译器会做逃逸分析(escape analysis),变量的作用域没有跑出函数范围，在栈上，反之在堆上。</p>
</li>
<li>
<p>实践</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e">#输出分析结果</span>
</span></span><span style="display:flex;"><span>go build -gcflags <span style="color:#e6db74">&#39;-m -l&#39;</span> main.go
</span></span><span style="display:flex;"><span><span style="color:#75715e">#反汇编查看,出现runtime.newobject,就发现逃逸行为</span>
</span></span><span style="display:flex;"><span>go tool compile -S main.go
</span></span></code></pre></div><p><img src="golang_escape.webp" alt="golang_escape"></p>
</li>
<li>
<p>结论</p>
<ul>
<li>
<p>常见逃逸</p>
<ul>
<li>
<p>在某个函数中new或字面量创建出的变量，将其指针作为函数返回值，则该变量一定发生逃逸（构造函数返回的指针变量一定逃逸）；</p>
<blockquote>
<p>建议:调用方传入参，被调用方直接把结果存进去</p>
<p>比如 read 函数的签名是 read([]byte)，而不是 read() []byte，就是为了避免堆分配.</p>
</blockquote>
</li>
<li>
<p>被已经逃逸的变量引用的指针，一定发生逃逸；</p>
</li>
<li>
<p>被指针类型的slice、map和chan引用的指针,一定发生逃逸,所以slice,map,chan尽管传值,不使用传指针,除非超大复制量；</p>
</li>
<li>
<p>申请超大容量变量,栈空间是有限的</p>
</li>
<li>
<p>作为fmt.printxxx参数,没事少用点</p>
</li>
<li>
<p>make,new,字面量初始化变量都一样要逃逸分析</p>
</li>
</ul>
</li>
<li>
<p>常见不逃逸</p>
<ul>
<li>指针被未发生逃逸的变量引用；</li>
<li>仅仅在函数内对变量做取址操作，而未将指针传出；</li>
</ul>
</li>
<li>
<p>可能发生逃逸</p>
<ul>
<li>将指针作为入参传给别的函数；这里还是要看指针在被传入的函数中的处理过程，如果发生了上边的三种情况，则会逃逸；否则不会逃逸；</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>泛型</p>
<ul>
<li>类型参数：泛型的抽象数据类型。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>TypeParameters  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[&#34;</span> TypeParamList <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;]&#34;</span> .
</span></span><span style="display:flex;"><span>TypeParamList   <span style="color:#f92672">=</span> TypeParamDecl <span style="color:#f92672">{</span> <span style="color:#e6db74">&#34;,&#34;</span> TypeParamDecl <span style="color:#f92672">}</span> .
</span></span><span style="display:flex;"><span>TypeParamDecl   <span style="color:#f92672">=</span> IdentifierList TypeConstraint .
</span></span></code></pre></div><ul>
<li>类型约束：确保调用方能够满足接受方的程序诉求。</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>TypeConstraint <span style="color:#f92672">=</span> TypeElem .
</span></span><span style="display:flex;"><span>TypeElem       <span style="color:#f92672">=</span> TypeTerm <span style="color:#f92672">{</span> <span style="color:#e6db74">&#34;|&#34;</span> TypeTerm <span style="color:#f92672">}</span> .
</span></span><span style="display:flex;"><span>TypeTerm       <span style="color:#f92672">=</span> Type | UnderlyingType .
</span></span><span style="display:flex;"><span>UnderlyingType <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;~&#34;</span> Type .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">内置comparable类型约束
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">comparable is an interface that is implemented by all comparable types (booleans, numbers, strings, pointers, channels, arrays of comparable types, structs whose fields are all comparable types). The comparable interface may only be used as a type parameter constraint, not as the type of a variable.*/</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">comparable</span> <span style="color:#66d9ef">interface</span>{ <span style="color:#a6e22e">comparable</span> }
</span></span></code></pre></div><ul>
<li>
<p>类型推导：避免明确地写出一些或所有的类型参数。</p>
</li>
<li>
<p>为保证GO1兼容性,标准库并没有引入泛型,试验性在golang.org/x/exp里</p>
</li>
</ul>
</li>
<li>
<p>Go 1.15 增加了一个新程序包，time/tzdata。该程序包允许将时区数据库嵌入程序中</p>
</li>
<li>
<p>Go1.16 开始禁止 import 导入的模块以 . 开头，模块路径中也不允许出现任何非 ASCII 字符</p>
</li>
<li>
<p>Go 1.16 新增的 embed 包支持资源嵌入</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">//把资源文件打包到二进制文件中
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#75715e">//go1.16引入新的标准库
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span> <span style="color:#a6e22e">_</span> <span style="color:#e6db74">&#34;embed&#34;</span>
</span></span><span style="display:flex;"><span> <span style="color:#e6db74">&#34;runtime/debug&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//golang特有编译器指示,类似//go:noinline,go:build
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//go:embed hello.txt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">hello</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//调试好帮手,打印出调用栈
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">debug</span>.<span style="color:#a6e22e">PrintStack</span>()
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;hello:&#34;</span>, <span style="color:#a6e22e">hello</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>弃用 io/ioutil,已移至其他程序包</li>
<li>timer性能提升,defer的性能，几乎是零开销</li>
<li>合并结构体标签tag设置标识</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MyStruct</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Field1</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json:&#34;field_1,omitempty&#34; bson:&#34;field_1,omitempty&#34; xml:&#34;field_1,omitempty&#34; form:&#34;field_1,omitempty&#34; other:&#34;value&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 就可以通过合并的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">MyStruct</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Field1</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`json,bson,xml,form:&#34;field_1,omitempty&#34; other:&#34;value&#34;`</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>
<p>context 主要用来在 goroutine 之间传递上下文信息，包括：取消信号、超时时间、截止时间、k-v 等.这篇<a href="https://zhuanlan.zhihu.com/p/425199722">文章</a>解释清楚.</p>
<ul>
<li>上游的信息共享给下游任务</li>
<li>上游可发送取消信号给所有下游任务,不会直接干涉和中断下游任务的执行,下游任务自行决定后续的处理操作.</li>
<li>下游任务自行取消不会影响上游任务</li>
<li>源码不理解?
<img src="golang_context_why1.webp" alt="why1">
<img src="golang_context_why2.webp" alt="why2"></li>
</ul>
</li>
<li>
<p>字符串,只读的切片,写入操作都是通过拷贝实现的。</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// 原始,特别适合不要转义
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">rawString</span>  = <span style="color:#e6db74">`\n \b \s \u`</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 带转义
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">normalStr</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;aabbcc&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 从string转[]byte，从[]byte转string,都是拷贝数据
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 而内存拷贝的性能损耗会随着字符串和 []byte 长度的增长而增长。
</span></span></span></code></pre></div><ul>
<li>数字字面量,下划线只为美观</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// 二进制110
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">binary</span> = <span style="color:#ae81ff">0b1_1_0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 十进制712
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">digit</span> = <span style="color:#ae81ff">7_1_2</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 向下取整,div=3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">div</span> = <span style="color:#ae81ff">7</span> <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> 
</span></span></code></pre></div><ul>
<li>数组</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">//明确指出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">arr1</span> <span style="color:#f92672">:=</span> [<span style="color:#ae81ff">3</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//编译器推定
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">arr2</span> <span style="color:#f92672">:=</span> [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">数组元素+数组大小相同才是同一类型，才能相等
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><ul>
<li>切片</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">//使用下标初始化切片不会拷贝原数组或者原切片中的数据，它只会创建一个指向原数组的切片结构体，所以修改新切片的数据也会修改原切片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">arr</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">3</span>] <span style="color:#a6e22e">or</span> <span style="color:#a6e22e">slice</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">//最终转化为上面方式
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//如果len/cap较小，最终转化为上面方式,否则运行时处理
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">slice</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">make([]type, len) 相当于 make([]type, len, len)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">b ;= a[low : high : max]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">b[0] = a[low]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">len(b) = high-low
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">cap(b) = max - low
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">a[low:high] 相当于 a[low : high : cap(a)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">a[:high] 相当于 a[0:high]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">a[low:] 相当于 a[low:len(a)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">a[:] 相当于 a[0:len(a)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><ul>
<li>map
<ul>
<li>cap理论上都是无穷的,使用自动扩容</li>
<li>内置的map多协程操作不安全</li>
<li>sync.map是多协程安全</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">//len是0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">firstMap</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//len是0,10只是帮助初次cap大小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">secMap</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">//len是2,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">threeMap</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">int</span>{
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;one&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;two&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 一般建议这种访问,区别val是否有效
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">val</span>, <span style="color:#a6e22e">exist</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">threeMap</span>[<span style="color:#e6db74">&#34;one&#34;</span>] 
</span></span><span style="display:flex;"><span>delete(<span style="color:#a6e22e">threeMap</span>, <span style="color:#e6db74">&#34;two&#34;</span>)
</span></span></code></pre></div><ul>
<li>
<p>函数</p>
<ul>
<li>
<p>参数的计算是从左到右</p>
</li>
<li>
<p>参数是<strong>值传递</strong>,返回值也是<strong>值传递</strong>,影响深远
<img src="golang_pass_value.webp" alt="pass_value"></p>
</li>
<li>
<p>slice,make,chan底层实现struct中包括指针,从而实现引用效果</p>
</li>
</ul>
</li>
<li>
<p>接口</p>
<ul>
<li>runtime.iface带方法,runtime.eface不带方法,两种不同.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">eface</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">_type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span>  <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">iface</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">tab</span>  <span style="color:#f92672">*</span><span style="color:#a6e22e">itab</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">itab</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">inter</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">interfacetype</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">_type</span><span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 类型断言时使用,复制_type中hash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">hash</span>  <span style="color:#66d9ef">uint32</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fun</span>   [<span style="color:#ae81ff">1</span>]<span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">_type</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ptrdata</span>    <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 类型断言时使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">hash</span>       <span style="color:#66d9ef">uint32</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">equal</span>      <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>) <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>隐式实现,区别其他语言</li>
<li>接口本身为nil,和接口值为nil是两回事</li>
<li>直接调用OR动态派发?编译器优化会把动态派发改为直接调用,以减少性能的额外开销.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Speak</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Man</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Voice</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Man</span>) <span style="color:#a6e22e">Speak</span>() {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Voice:&#34;</span>, <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Voice</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Man</span>{<span style="color:#a6e22e">Voice</span>: <span style="color:#e6db74">&#34;firstMan&#34;</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">p</span> <span style="color:#a6e22e">Person</span> = <span style="color:#a6e22e">m</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//直接调用,类型转换是编译期完成
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">p</span>.(<span style="color:#f92672">*</span><span style="color:#a6e22e">Man</span>).<span style="color:#a6e22e">Speak</span>()
</span></span><span style="display:flex;"><span><span style="color:#75715e">//动态派发,比直接调用多取出data和fun两个动作
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Speak</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<p>gc</p>
<ul>
<li>
<p>暂停程序（Stop the world，STW），随着程序申请越来越多的内存，系统中的垃圾也逐渐增多；当程序的内存占用达到一定阈值时，整个应用程序就会全部暂停，垃圾收集器会扫描已经分配的所有对象并回收不再使用的内存空间，当这个过程结束后，用户程序才可以继续执行.</p>
</li>
<li>
<p>垃圾收集可以分成清除终止、标记、标记终止和清除</p>
</li>
<li>
<p>用户程序,分配器,gc收集器,head关系图

<div class="mermaid" align="center">

  sequenceDiagram
      actor m as 用户程序
      actor a as 分配器
      actor h as heap堆内存
      actor c as gc收集器
      m->>a: make/new等申请内存
      a->>h: malloc申请,初始化
      c-->>h: free释放内存

  </div>
</p>
</li>
<li>
<p>栈空间,不用码农操作心, 大致了解连续栈,栈扩容,栈收缩一下</p>
</li>
</ul>
</li>
<li>
<p>反射,影响性能,不必要不使用.</p>
<ul>
<li>第一原则,任意类型变量转换成反射对象</li>
</ul>

<div class="mermaid" align="center">

  flowchart LR
  int(int) --类型转换--> i(interface对象)
  float(float) --类型转换--> i
  bool(bool) --类型转换--> i
  string(string) --类型转换--> i
  struct(struct) --类型转换--> i
  slice(slice) --类型转换--> i
  array(array) --类型转换--> i
  subgraph 反射对象
  subgraph TypeOf
    ri(reflect.Type)
  end
  subgraph ValueOf
    rv(reflect.Value)
  end
  i --类型转换--> ri
  i --类型转换--> rv
  end

  </div>

<ul>
<li>第二原则,反射对象可以获取 interface{} 变量</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#e6db74">&#34;st&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Interface</span>().(<span style="color:#66d9ef">string</span>)
</span></span></code></pre></div>
<div class="mermaid" align="center">

  flowchart LR
  rv(reflect.Value) --Interface方法--> i(interface对象)
  i --类型断言--> string(string)
  </div>

</li>
<li>
<p>第三原则,通过反射对象修改值,要传指针</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span> <span style="color:#a6e22e">mystr</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;old&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">//直接传mystr是不行的
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">vo</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">mystr</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">vo</span>.<span style="color:#a6e22e">Elem</span>().<span style="color:#a6e22e">SetString</span>(<span style="color:#e6db74">&#34;new&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">mystr</span>)
</span></span></code></pre></div><ul>
<li>
<p>for</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">for</span>  {  } <span style="color:#a6e22e">相当于</span> <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">true</span>  {  }
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> <span style="color:#a6e22e">cond</span> { }  <span style="color:#a6e22e">相当于</span>   <span style="color:#66d9ef">for</span> ; <span style="color:#a6e22e">cond</span> ; { }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// RangeClause = [ ExpressionList &#34;=&#34; | IdentifierList &#34;:=&#34; ] &#34;range&#34; Expression .
</span></span></span></code></pre></div><ul>
<li>for-range
<ul>
<li>遍历之前都有copy数组/切片/map/chan,</li>
<li>golang里面一切都是值拷贝,注意值拷贝带来的影响</li>
<li>循环变量每次都重新copy</li>
</ul>
</li>
</ul>
</li>
<li>
<p>channel</p>
<ul>
<li>
<p>只有make一种创建方式,要不为nil,要不为有效chan</p>
</li>
<li>
<p>有无缓冲?</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// 无缓冲
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>make(<span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">Type</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 有缓冲
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>make(<span style="color:#66d9ef">chan</span> <span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">Len</span>(<span style="color:#a6e22e">buf</span>))
</span></span></code></pre></div><ul>
<li>
<p>读取</p>
<ul>
<li>读取nil channel永远阻塞,Receiving from a nil channel blocks forever.</li>
<li>第二值为true,表示第一值为发送值,否则表示第一值zero value,系统构造的,暗示channel已经close</li>
<li>channel关闭是指不能再写入,不影响读取.已经关闭的channel仍然能被读取</li>
</ul>
</li>
<li>
<p>先入先出,先写入数据先被读取出来</p>
</li>
<li>
<p>close一个空指针或者已经被关闭channel,运行时都会直接崩溃并抛出异常：</p>
</li>
</ul>
</li>
<li>
<p>select</p>
<ul>
<li>每个case一个Channel上非阻塞的收发操作；</li>
<li>多个case同时响应时，会随机执行一种情况；</li>
<li>如果default存在,则在case不响应时立即执行，否则阻塞等待case响应</li>
</ul>
</li>
<li>
<p>defer</p>
<ul>
<li>退出函数之前执行</li>
<li>多次调用 defer执行顺序:先进后出,后进先出</li>
<li>defer func参数在调用时求值,仍旧是值传递</li>
</ul>
</li>
<li>
<p>panic</p>
<ul>
<li>panicc后会立刻停止执行当前函数的剩余代码</li>
<li>仅执行本Goroutine中的defer</li>
<li>如果defer中没有recover处理,则整个程序退出(os.exit)</li>
<li>允许多次panic&mdash;在执行defer时,还可以再次panic</li>
</ul>
</li>
<li>
<p>recover</p>
<ul>
<li>
<p>只有在 defer 中调用才会生效,其他地方无效</p>
</li>
<li>
<p>可以中止 panic 造成的程序崩溃</p>
</li>
<li>
<p>返回值为最近的panic参数,返回值为nil情况</p>
<ul>
<li>panic&rsquo;s argument was nil;</li>
<li>the goroutine is not panicking;</li>
<li>recover was not called directly by a deferred function.</li>
</ul>
</li>
<li>
<p>一次recover只能恢复一个panic</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">defer</span> println(<span style="color:#e6db74">&#34;main exit&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">reply</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;recover:&#34;</span>, <span style="color:#a6e22e">reply</span>.(<span style="color:#66d9ef">string</span>))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  panic(<span style="color:#e6db74">&#34;panic another&#34;</span>)
</span></span><span style="display:flex;"><span>}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">reply</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;recover:&#34;</span>, <span style="color:#a6e22e">reply</span>.(<span style="color:#66d9ef">string</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">reply</span> <span style="color:#f92672">:=</span> recover(); <span style="color:#a6e22e">reply</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;recover:&#34;</span>, <span style="color:#a6e22e">reply</span>.(<span style="color:#66d9ef">string</span>))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  panic(<span style="color:#e6db74">&#34;panic continue&#34;</span>)
</span></span><span style="display:flex;"><span>  }()
</span></span><span style="display:flex;"><span>  panic(<span style="color:#e6db74">&#34;panic begin&#34;</span>)
</span></span><span style="display:flex;"><span>}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span></code></pre></div></li>
<li>
<p>sync</p>
<ul>
<li>Mutex,RWMutex</li>
</ul>

<div class="mermaid" align="center">

    flowchart LR
    l(Locker) --实现接口--> m(Mutex)
    m --继承--> rw(RWMutex)

    </div>

<ul>
<li>
<p>WaitGroup</p>
<ul>
<li>一些扩展使用
<ul>
<li>golang/sync/errgroup.Group带错误传播</li>
<li>golang/sync/singleflight.Group限制同时产生大量相同请求</li>
</ul>
</li>
</ul>
</li>
<li>
<p>pool临时对象复用池</p>
</li>
<li>
<p>Map 多协程安全操作map,对内置map扩展</p>
</li>
<li>
<p>Once 保证只执行一次</p>
</li>
<li>
<p>Cond 信号量</p>
<ul>
<li>扩展使用
<ul>
<li>golang/sync/semaphore.Weighted带权重信号量</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>协程调度</p>
<ul>
<li>G-M-P模型
<ul>
<li>M是操作系统线程,由操作系统管理,GOMAXPROCS(一般是当前机器的核数)个活跃线程</li>
<li>G是Go运行时中用户态提供的线程,代表待执行的任务,表现为函数执行</li>
<li>P是线程和G的中间层,一个线程一个P,一个P一个本地G的队列,优先取本地的运行队列,然后取全局的运行队列</li>
</ul>
</li>
</ul>
</li>
<li>
<p>time</p>
<ul>
<li>Timer&ndash;&gt;单次事件,The Timer type represents a single event.</li>
<li>Ticker&ndash;&gt;定时器,A Ticker holds a channel that delivers “ticks” of a clock at intervals.</li>
<li>Duration&ndash;&gt;时间长度,例如:1分钟,10天</li>
<li>Time&ndash;&gt;时间点,例如:2022年1月2日03点4分15秒</li>
<li>Location&ndash;&gt;时区,例如:北京时间</li>
<li>tzdata&ndash;&gt;子包,打包时区数据库到程序,会增加程序二进制大小</li>
<li>每个处理器单独管理计时器并通过网络轮询器触发</li>
<li>golang.org/x/time/rate扩展包带了一个令牌桶限流算法</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// token自动按速率产生,通过Wait/Allow消费token
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 10是每秒可以向 Token 桶中产生多少 token
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 100是 代表 Token 桶的容量大小
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">limiter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">rate</span>.<span style="color:#a6e22e">NewLimiter</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">100</span>);
</span></span></code></pre></div></li>
<li>
<p>json</p>
<ul>
<li>JSON 本身就是一种树形的数据结构，无论是序列化还是反序列化，都会遵循自顶向下的编码和解码过程，使用递归的方式处理 JSON 对象。</li>
<li>采用反射完成序列化/反序列化逻辑</li>
<li>struct对象可以tag调整json序列化/反序列化行为</li>
</ul>
</li>
<li>
<p>net</p>
<ul>
<li>
<p>listen(network, address string)</p>
<ul>
<li>The network must be &ldquo;tcp&rdquo;, &ldquo;tcp4&rdquo;, &ldquo;tcp6&rdquo;, &ldquo;unix&rdquo; or &ldquo;unixpacket&rdquo;.
For TCP networks, if the host in the address parameter is empty or a literal unspecified IP address, Listen listens on all available unicast and anycast IP addresses of the local system. To only use IPv4, use network &ldquo;tcp4&rdquo;. The address can use a host name, but this is not recommended, because it will create a listener for at most one of the host&rsquo;s IP addresses. If the port in the address parameter is empty or &ldquo;0&rdquo;, as in &ldquo;127.0.0.1:&rdquo; or &ldquo;[::1]:0&rdquo;, a port number is automatically chosen. The Addr method of Listener can be used to discover the chosen port.</li>
</ul>
</li>
<li>
<p>Dial(network, address string)</p>
<ul>
<li>Known networks are &ldquo;tcp&rdquo;, &ldquo;tcp4&rdquo; (IPv4-only), &ldquo;tcp6&rdquo; (IPv6-only), &ldquo;udp&rdquo;, &ldquo;udp4&rdquo; (IPv4-only), &ldquo;udp6&rdquo; (IPv6-only), &ldquo;ip&rdquo;, &ldquo;ip4&rdquo; (IPv4-only), &ldquo;ip6&rdquo; (IPv6-only), &ldquo;unix&rdquo;, &ldquo;unixgram&rdquo; and &ldquo;unixpacket&rdquo;.
For TCP and UDP networks, the address has the form &ldquo;host:port&rdquo;.</li>
</ul>
</li>
<li>
<p>扩展包golang.org/x/net有不少好功能实现</p>
</li>
</ul>
</li>
<li>
<p>http</p>
<ul>
<li>
<p>客户端,核心两个结构-Request,Response</p>
<ul>
<li>net/http.Client</li>
<li>net/http.Transport</li>
<li>net/http.persistConn

<div class="mermaid" align="center">

      flowchart LR
      c(Client) --调用--> t(Transport)
      t --调用-->c(persistConn)

      </div>
</li>
</ul>
</li>
<li>
<p>服务端,核心两个结构-Request,ResponseWriter</p>
<ul>
<li>net/http.Server</li>
<li>net/http.ServeMux</li>
<li>net/http.Handler

<div class="mermaid" align="center">

      flowchart LR
      c(Server) --调用--> t(ServeMux)
      t --调用-->c(Handler)

      </div>
</li>
</ul>
</li>
<li>
<p>RoundTripper,代表一个http事务,给一个请求返回一个响应,可以自定义功能,例如:缓存responses</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">RoundTripper</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">RoundTrip</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">Request</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Response</span>, <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>net/http/httptrace,net/http/httptrace</li>
</ul>
</li>
<li>
<p>golang.org/x/image扩展bmp,webp等功能实现</p>
</li>
<li>
<p>golang.org/x/text扩展不少像gbk转utf8,高级文本搜索等功能</p>
</li>
<li>
<p>io.Reader/Writer</p>
<ul>
<li>net.Conn: 表示网络连接。</li>
<li>os.Stdin, os.Stdout, os.Stderr: 标准输入、输出和错误。</li>
<li>os.File: 网络,标准输入输出,文件的流读取。</li>
<li>strings.Reader: 字符串抽象成 io.Reader 的实现。</li>
<li>bytes.Reader: []byte抽象成 io.Reader 的实现。</li>
<li>bytes.Buffer: []byte抽象成 io.Reader 和 io.Writer 的实现。</li>
<li>bufio.Reader/Writer: 带缓冲的流读取和写入（比如按行读写）。</li>
</ul>
</li>
<li>
<p>sql</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Driver</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Conn</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">DB</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// contains filtered or unexported fields
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Stmt</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// contains filtered or unexported fields
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Tx</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// contains filtered or unexported fields
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><ul>
<li>
<p>测试</p>
<ul>
<li>功能测试</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// 文件名格式xxx_test.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 函数名格式TestXxx,Test开头,第一个字母必须大写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 函数参数必须是t *testing.T
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 失败采用t.Fatalxxx,t.Errorxx输出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TestAdd</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Add</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">12</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#e6db74">&#34;failure&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 启动</span>
</span></span><span style="display:flex;"><span>go test
</span></span></code></pre></div><ul>
<li>压力测试</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// 文件名格式xxx_test.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 函数名格式BenchmarkXxx,Benchmark开头,第一个字母必须大写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 函数参数必须是b *testing.B
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 测试性能前提是功能正确,所以没有失败一说
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">BenchmarkAdd</span>(<span style="color:#a6e22e">b</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">B</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">N</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Int</span>(), <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Int</span>())
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 启动, -bench pattern正则表达式，测试目标</span>
</span></span><span style="display:flex;"><span>go test -bench .
</span></span></code></pre></div><ul>
<li>随机测试</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// 文件名格式xxx_test.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 函数名格式FuzzXxx,Fuzz开头,第一个字母必须大写
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 函数参数必须是f *testing.F
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 失败采用t.Fatalxxx,t.Errorxx输出
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">FuzzAdd</span>(<span style="color:#a6e22e">f</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">F</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">10</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 随机种子语料
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// f.Add参数个数及类型及顺序，必须和后面一样
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Int</span>(), <span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Int</span>())
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// func(t *testing.T, left, right int), 参数除t之外, 参数个数及类型及顺序，必须和f.Add一样
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">Fuzz</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">t</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">testing</span>.<span style="color:#a6e22e">T</span>, <span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">right</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">right</span>) <span style="color:#f92672">!=</span> <span style="color:#a6e22e">left</span><span style="color:#f92672">+</span><span style="color:#a6e22e">right</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">Errorf</span>(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;%v+%v=%v, result:%v&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">right</span>, <span style="color:#a6e22e">Add</span>(<span style="color:#a6e22e">left</span>, <span style="color:#a6e22e">right</span>), <span style="color:#a6e22e">left</span><span style="color:#f92672">+</span><span style="color:#a6e22e">right</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># 启动,会一直执行下去,除非加上 -fuzztime 30s 指定运行时间</span>
</span></span><span style="display:flex;"><span>go test -fuzz Fuzz
</span></span></code></pre></div></li>
</ul>
</li>
</ul>





<footer class=" footline" >
	
</footer>


</div>


</div>

<div id="navigation">
    
    

    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    
    
    

    
    
    

    
    
    
    
    
    
    
    
    

    


    
    
    
    <a class="nav nav-prev" href="/git/" title="git"> <i class="fa fa-chevron-left"></i></a>
    
    
    <a class="nav nav-next" href="/golang/context/" title="context" style="margin-right: 0px;"><i
            class="fa fa-chevron-right"></i></a>
    
    
</div>

</section>

<div
    style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
    <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>
<script src="/js/clipboard.min.js?1677750506"></script>
<script src="/js/perfect-scrollbar.min.js?1677750506"></script>
<script src="/js/perfect-scrollbar.jquery.min.js?1677750506"></script>
<script src="/js/jquery.sticky.js?1677750506"></script>
<script src="/js/featherlight.min.js?1677750506"></script>
<script src="/js/highlight.pack.js?1677750506"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/modernizr.custom-3.6.0.js?1677750506"></script>
<script src="/js/learn.js?1677750506"></script>
<script src="/js/hugo-learn.js?1677750506"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js"></script>

<script>
    mermaid.initialize({
        startOnLoad: true,
        sequence: {showSequenceNumbers: true},
    });
</script>



</body>

</html>